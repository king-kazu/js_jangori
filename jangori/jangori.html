<!DOCTYPE html>
<head lang="ja">
    <meta charset="utf-8">
    <title>教えて！じゃんゴリ先生</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Stick&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
     
</head>
<main>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <h1 class="text-center">教えて！じゃんゴリ先生</h1>
        <p class="text-center">-プログラミング相談室-</p>
        <p class="gorilla-say" id="gorilla_called">なんでエラーなんだ...もう無理だ</p>
    <div class="image_top_div">
        <img src="PC_gori1.png" alt="寝姿勢のゴリラ" class="img_top" id="img_top">
    </div>
    <div id="text">
        <p>↓じゃんゴリ先生に相談する</p>
        <p class="mic">（マイクが起動します)</p>
    </div> 
    <div class="text-center btn-wrap">
        <button id="startRecBtn" class="btn">相談内容を伝える</button>
        <input type="button" value="相談室に戻る" class="btn-koshin" onclick="koshin()">
    </div>

    <div class="talk-list-wrap">
        <p class="text-title-q">↓例えばこんなふうに声をかけてみましょう↓</p>
        <div class="talk-list">
            <p class="text-q">エラーが出て困っています</p>
            <p class="text-q">つくりたいものが決まらなくて困っています</p>
            <p class="text-q">プログラミングがうまくできなく悩んでいます</p>
            <p class="text-q">すべてが難しいです</p>
            <p class="text-q">宇宙人っているんですか？  etc</p>   
        </div>
        <p class="text-q alert">※重要※ 絶対に「エネゴリ」と間違えないでください。</p>   
    </div>
    
    <p class="text-guide">一度相談したら「相談室に戻る」をクリック↑</p>

<script>
    SpeechRecognition = webkitSpeechRecognition || SpeechRecognition
    let talk = new webkitSpeechRecognition();
        talk.interimResults = false;
        talk.lang = 'ja-JP';

        let userSaid = (str, s) => {
            return str.includes(s);
        }

        const balloon = {
            "border-bottom" : "none",
            "font-size" : "20px",
            "color" :  "black",
            "background-color" : "beige"
        }
        
        talk.onresult = (event) => {
            for (let i = event.resultIndex; i < event.results.length; i++) {
                if (event.results[i].isFinal) {
                        let str = event.results[i][0].transcript;
                        console.log('Recognised: ' + str);
                        if (userSaid(str, 'エラー')) {
                            $("img[src='PC_gori1.png']").attr('src','shoulder_gori.png');
                            $('#gorilla_called').html("<p>「エラーとマブダチになれ」</p>").css(balloon);
                            } 
                        else if (userSaid(str, '作りたいもの')) {
                            $("img[src='PC_gori1.png']").attr('src','th_gori_yubisashi.png');
                            $('#gorilla_called').html("<p>答えはいつも自分の中にある</p>").css(balloon);
                            }
                        else if (userSaid(str, '悩んで')) {
                            $("img[src='PC_gori1.png']").attr('src','th_sailor_fuku_gori.png');
                            $('#gorilla_called').html("<p>...オレだって悩んでんだよ</p>").css(balloon);
                            }
                        else if (userSaid(str, '宇宙人')) {
                            $("img[src='PC_gori1.png']").attr('src','Things_UFO_catt_gori.png');
                            $('#gorilla_called').html("<p>オレの口からは何も言えない</p>").css(balloon);
                            }
                        else if (userSaid(str, '難しい')) {
                            $("img[src='PC_gori1.png']").attr('src','th_gouu_gori.png');
                            $('#gorilla_called').html("<p>簡単にできたら楽しくないだろ</p>").css(balloon);
                            }
                        else if (userSaid(str, 'うまく')) {
                            $("img[src='PC_gori1.png']").attr('src','th_PC_gori3.png');
                            $('#gorilla_called').html("<p>そんなときはこの姿勢</p>").css(balloon);
                            }
                        else if (userSaid(str, 'エネゴリ')) {
                            $("img[src='PC_gori1.png']").attr('src','th_angry_gori.png');
                            $('#gorilla_called').html("<p>エネゴリとは犬猿の仲なんだ！</p>").css(balloon);
                            }
                        else {
                            $("img[src='PC_gori1.png']").attr('src','th_gori_fakesmile.png');
                            $('#gorilla_called').html("<p>ちょっと何言ってるかわかんなかった</p>").css(balloon);
                            }
                }
            }
        }
                            
    $("#startRecBtn").on("click", function() {
      talk.start();
    });

    const koshin = () => location.reload();

</script>
    <footer class="footer text-center">
        <small class="copyrights">copyrights 2021 JANGORI All Rights Reserved.</small>
    </footer>
</main>
</html>